'use strict';

let ISMCTS = require('../search/ismcts.js');
let stringify = require('json-stringify-safe');
let Dumper = require('./dumper.js');
let Minimax = require('../search/minimax.js');
let DeterminizedUCT = require('../search/determinized-uct');

let seedrandom = require('seedrandom');
let rng = seedrandom();
let _ = require('lodash');

let Sueca = require('../games/sueca');
let MiniSueca = require('../games/mini-sueca');
let Bisca = require('../games/bisca');
let Hearts = require('../games/hearts');

let Game = Sueca;

// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["A♠","Q♣","5♥","2♣","Q♠","4♦","K♦","7♠","7♥"]],"trump":"♦","trick":["6♥","A♥","3♥",null],"trumpCard":"3♦","trumpPlayer":1,"wonCards":[["2♦","4♣","J♣","A♣"],[],[],[]],"round":2,"suitToFollow":"♥","hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":false},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":108,"S":[134,4,140,191,100,118,9,59,153,251,196,157,215,47,68,91,235,15,111,13,32,107,20,213,241,115,81,123,201,137,204,23,53,37,75,181,207,131,26,39,30,65,203,189,234,28,182,237,214,178,146,164,55,247,2,255,109,88,230,124,43,94,7,116,228,0,192,119,5,102,125,101,145,113,70,139,162,71,114,209,129,141,184,195,54,12,117,151,31,11,248,193,150,172,226,77,14,186,154,50,211,242,216,231,67,74,41,175,133,69,6,78,21,168,199,61,93,187,18,45,246,169,249,232,250,103,225,105,22,35,73,92,90,142,95,128,148,58,220,190,233,40,160,27,171,223,80,132,218,224,44,188,83,10,254,138,238,136,185,56,208,108,62,97,1,122,197,3,84,217,205,144,159,194,130,176,19,222,180,212,104,121,147,155,158,240,24,120,46,202,89,52,198,8,126,85,34,112,243,72,167,227,174,106,76,51,38,79,36,156,244,143,221,96,161,60,17,152,206,245,48,42,135,49,163,200,239,82,16,179,33,229,29,170,210,149,98,99,87,110,57,64,253,127,63,236,219,173,165,177,25,86,166,66,252,183]},"player":3,"iterations":10000};

// let savedState = {"game":{"currentPlayer":1,"hands":[[],["4♥","4♦","K♦","J♣","2♠","5♣","J♥","2♦","7♦","K♣"],[],[]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"3♣","trumpPlayer":0,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":20,"S":[67,54,108,170,63,64,203,207,221,155,184,92,204,182,40,158,219,113,49,183,50,102,225,147,248,149,209,193,72,241,253,157,196,75,60,100,245,38,202,87,230,212,103,224,24,237,195,236,107,137,220,243,227,25,188,165,252,172,12,134,153,47,0,143,139,168,181,223,231,21,33,161,176,197,106,36,205,18,199,254,53,95,5,206,185,235,123,142,41,88,22,58,133,85,109,151,146,80,216,234,251,239,23,77,48,213,115,166,1,148,229,214,79,104,15,173,66,159,160,174,189,169,180,10,164,240,129,178,93,247,42,126,11,26,250,71,116,43,124,122,162,90,140,91,179,175,32,117,89,226,194,3,135,20,14,136,154,101,171,121,61,190,217,150,128,167,145,114,112,131,74,211,97,29,105,62,111,98,132,210,76,27,120,46,52,191,242,94,73,186,4,238,152,68,125,246,198,86,30,119,233,59,130,56,96,13,192,44,37,6,249,28,17,83,16,118,7,208,9,141,215,69,78,138,51,228,39,200,255,156,70,201,31,127,55,244,163,2,57,144,218,45,19,110,222,84,34,187,99,8,177,81,65,82,35,232]},"player":1,"iterations":10000}

// A or 7 in hand, what to use first
// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["J♥","A♠","J♠","6♥","7♠","Q♠","7♥","5♦","4♦","Q♥"]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"7♣","trumpPlayer":2,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":173,"S":[180,111,205,246,14,179,252,136,185,12,40,17,133,114,43,62,235,67,0,130,184,196,157,197,217,41,169,115,50,58,142,147,25,165,168,122,42,89,51,93,224,27,26,152,201,216,189,37,36,174,105,228,193,48,57,144,207,172,59,153,127,79,75,214,186,242,94,86,243,159,148,77,63,68,81,250,3,10,103,34,206,233,128,199,253,237,30,166,74,90,182,248,240,254,29,236,171,102,155,4,160,162,84,150,215,255,188,178,2,7,66,18,137,53,110,116,80,139,167,121,78,113,219,146,251,23,232,195,163,100,226,154,88,239,61,13,65,108,125,19,60,173,5,98,204,134,46,31,170,183,22,131,45,247,211,231,28,176,70,202,32,156,52,181,161,129,203,9,151,109,132,145,119,64,194,20,245,241,143,200,21,192,95,164,120,85,238,55,177,158,138,101,213,135,69,244,190,72,49,44,218,141,112,149,16,6,230,106,187,83,24,82,76,1,54,96,71,117,126,33,104,223,208,225,229,38,198,92,91,234,220,140,123,73,11,47,97,221,99,124,222,15,39,227,249,209,56,35,8,175,210,191,87,118,212,107]},"player":3,"iterations":10000};

// let savedState = {"game":{"currentPlayer":1,"hands":[[],["6♠","6♣","3♥","6♦","J♣","J♦","2♦","A♥"],[],[]],"trump":"♣","trick":["4♥",null,null,null],"trumpCard":"7♣","trumpPlayer":2,"wonCards":[["2♣","3♠","2♠","A♠"],[],[],["5♠","K♠","4♠","7♠"]],"round":3,"suitToFollow":"♥","hasSuits":[{"♠":false,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":63,"S":[167,66,76,155,14,147,226,99,144,199,196,72,224,100,218,168,142,180,63,109,85,221,246,138,52,107,94,106,22,77,119,236,162,160,59,214,124,241,208,164,40,39,154,240,112,24,6,132,11,235,253,35,250,15,105,115,178,165,186,56,148,133,81,143,32,34,20,182,198,255,141,135,249,2,242,254,211,151,88,171,174,70,64,201,37,244,110,61,67,58,179,62,111,137,86,139,75,188,202,50,200,234,51,189,176,93,12,127,161,26,183,220,18,219,252,225,203,16,3,0,152,78,69,233,73,21,136,213,101,90,80,157,84,43,131,54,79,36,82,140,210,230,191,47,25,156,31,192,195,30,4,206,29,245,96,193,44,104,38,45,23,89,27,187,123,92,103,209,146,60,121,114,71,74,48,205,130,227,223,134,169,87,42,145,190,216,10,194,153,175,91,177,158,243,57,231,41,204,215,128,150,166,125,83,49,116,228,95,98,17,65,118,53,251,248,19,113,129,9,222,68,232,184,181,163,97,28,13,126,108,229,117,102,217,212,5,8,7,239,237,197,238,33,207,172,149,120,173,159,247,170,46,185,55,1,122]},"player":1,"iterations":10000};

// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♥","J♥","7♥","3♥","A♣","J♠","6♦","5♠","6♠"]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"2♣","trumpPlayer":2,"wonCards":[[],[],[],["2♦","Q♦","4♦","A♦"]],"round":2,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":121,"S":[5,111,224,182,249,129,89,38,29,153,116,113,117,32,43,98,192,77,138,125,64,196,21,33,130,165,10,181,49,8,220,132,50,107,65,227,228,102,247,175,22,56,134,226,169,156,96,176,92,214,34,191,67,222,207,198,47,250,221,205,162,122,12,78,242,211,59,193,135,236,63,103,210,184,81,174,186,172,7,71,234,173,119,188,146,199,251,126,203,167,202,123,62,15,204,53,254,212,237,35,225,42,219,255,208,155,157,72,151,190,163,120,99,252,45,144,39,73,20,106,30,58,2,60,195,159,115,230,27,170,164,17,244,46,158,253,147,216,246,51,243,28,128,76,194,68,218,248,37,84,87,215,118,131,109,133,93,79,104,105,206,209,180,83,177,139,200,166,127,187,94,6,239,160,201,86,231,52,223,88,97,85,57,152,31,161,61,154,112,148,189,149,3,217,44,179,213,1,145,141,168,9,19,110,238,25,11,232,80,41,90,24,26,66,136,36,95,229,185,55,70,69,121,82,74,48,178,40,13,18,143,14,240,183,150,140,114,108,233,16,0,75,23,4,137,54,171,235,91,142,124,101,241,100,197,245]},"player":3,"iterations":10000}

// 4 card game
// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","Q♥","J♦","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","6♠","5♠","4♠","3♠"],["A♥","7♥","6♥","5♥","4♥","3♥"],["A♦","7♦","6♦","5♦","4♦","3♦"],["A♣","7♣","6♣","5♣","4♣","3♣"]],"round":7,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};


// 3 card game
// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","Q♥","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","J♠","6♠","5♠","4♠","3♠"],["A♥","7♥","J♥","6♥","5♥","4♥","3♥"],["A♦","7♦","J♦","6♦","5♦","4♦","3♦"],["A♣","7♣","J♣","6♣","5♣","4♣","3♣"]],"round":8,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};

// 2 card game
// let savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","Q♠","J♠","6♠","5♠","4♠","3♠"],["A♥","7♥","Q♥","J♥","6♥","5♥","4♥","3♥"],["A♦","7♦","Q♦","J♦","6♦","5♦","4♦","3♦"],["A♣","7♣","Q♣","J♣","6♣","5♣","4♣","3♣"]],"round":9,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};

// let savedState = {"game":{"currentPlayer":0,"hands":[["2♠","2♦","Q♥"],[],[],[]],"trump":"♠","trick":[null,null,null,null],"trumpCard":"K♠","trumpPlayer":3,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":null,"player":0};

// bisca, should play the easy A♥
// let savedState = {"game":{"numberOfPlayers":2,"currentPlayer":1,"deck":[null,"A♣"],"hands":[["A♥","J♣","4♣","6♠","2♦","Q♠","5♥","2♣","4♠"],[null,null,null,null,null,null,null,null]],"trick":[null,"K♥"],"trumpCard":"A♣","trump":"♣","wonCards":[["5♠","2♠","A♠","J♠","7♣","Q♥","2♥","Q♦","4♥","J♦"],["6♥","7♥","3♦","4♦","3♠","5♦","3♥","6♦","K♠","7♠"]],"round":11,"suitToFollow":"♥","hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":120,"S":[166,95,4,92,192,218,206,65,107,10,26,178,212,49,24,30,31,83,59,119,167,153,227,128,93,160,170,181,142,243,193,136,174,228,121,56,158,69,41,117,77,103,123,5,118,239,157,134,223,100,179,112,57,152,50,252,210,229,143,131,61,11,221,122,80,144,132,71,73,189,207,22,66,253,194,114,164,135,195,35,138,45,13,86,68,42,211,0,21,238,249,156,85,197,127,1,89,111,94,18,115,159,34,188,25,33,27,208,219,169,186,205,200,133,101,196,125,78,154,183,191,215,222,146,14,247,251,102,234,161,40,7,39,173,54,16,203,74,245,48,15,163,53,255,2,109,84,47,155,60,148,130,63,240,98,76,236,108,38,99,19,20,225,75,52,46,199,90,140,217,88,113,72,190,204,176,106,232,233,67,139,168,55,8,87,147,70,91,184,105,244,17,137,81,23,224,43,150,216,110,64,36,177,171,248,202,129,172,180,231,29,214,165,198,182,241,213,226,104,32,235,162,9,124,44,145,58,6,237,209,62,120,3,97,149,254,126,201,96,187,51,242,116,175,246,12,151,79,82,220,250,28,37,141,230,185]},"player":1,"iterations":10000};

//let savedState = {"game":{"numberOfPlayers":2,"currentPlayer":2,"deck":[],"hands":[[null,null,"K♣"],["2♥","4♥","2♣","6♦"]],"trick":["3♠",null],"trumpCard":"K♣","trump":"♣","wonCards":[["Q♣","Q♥","J♠","2♠","5♣","5♥","3♣","4♦","6♣","6♠","A♣","3♦","7♣","5♦","4♣","4♠","J♦","Q♦","K♥","6♥","7♠","5♠","A♦","K♦","Q♠","A♥"],["2♦","7♦","A♠","J♣","3♥","7♥"]],"round":17,"suitToFollow":"♠","hasSuits":[{"♠":false,"♥":true,"♦":true,"♣":true},{"♠":false,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":62,"S":[24,198,67,243,62,77,214,244,204,237,104,26,213,124,15,129,31,241,63,23,182,19,255,112,117,68,206,159,66,83,122,252,200,195,61,58,86,183,234,253,203,41,216,5,132,227,46,11,134,45,192,76,242,240,125,140,0,189,145,17,87,108,146,70,32,161,75,69,162,225,235,82,155,131,174,191,212,248,230,165,9,229,35,236,144,3,254,116,188,128,172,194,27,171,14,228,137,54,12,2,28,107,130,197,43,30,101,55,186,42,20,164,73,136,25,97,7,89,4,121,8,105,103,93,133,72,187,150,65,153,178,219,211,151,78,71,160,220,18,166,114,168,249,51,221,218,126,53,37,176,251,226,85,100,215,180,148,217,245,91,205,102,163,135,115,36,47,57,111,49,90,106,44,181,246,149,110,199,173,74,208,247,156,60,201,232,196,50,123,33,231,127,34,143,109,38,233,92,84,157,184,154,175,79,88,167,6,224,119,94,120,48,158,222,190,59,118,98,169,152,10,80,52,250,177,64,142,141,170,40,147,138,1,96,95,185,179,16,81,223,209,113,99,207,21,202,139,39,22,56,193,239,210,13,238,29]},"player":2,"iterations":10000};

// hearts, could use the Q♠ but the leading player has 0% chance of winning, so the card is kept, why?
// let savedState = {"game":{"isHeartsBroken": true, "currentPlayer":3,"hands":[[null,null,null],[null,null,null],["Q♠","6♥","K♥","7♦"],[null,null,null]],"trick":["J♥","8♥",null,"A♣"],"wonCards":[["J♣","7♣","9♣","2♣","1♠","8♣","8♠","7♠"],["J♦","K♦","1♦","3♦","9♦","A♦","Q♦","8♦"],["K♠","2♠","A♠","J♠","2♦","4♦","6♦","Q♣"],["3♠","6♣","6♠","9♠","3♣","4♣","5♣","1♣","A♥","7♥","4♠","5♠"]],"round":10,"suitToFollow":"♣","receivedHearts":[false,false,false,true],"hasSuits":[{"♠":false,"♥":true,"♦":true,"♣":false},{"♠":false,"♥":true,"♦":true,"♣":false},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":false,"♣":true}]},"rng":{"i":0,"j":134,"S":[188,211,21,69,31,0,255,109,78,169,163,165,18,3,59,37,201,170,206,87,112,106,207,210,38,249,127,123,164,111,135,115,56,65,93,248,9,145,168,41,233,81,34,6,241,180,53,90,23,94,154,76,82,60,104,1,103,156,197,83,43,138,208,185,227,124,114,91,140,161,243,102,107,130,220,179,213,160,92,152,49,212,200,192,44,214,64,153,144,186,247,190,159,8,173,52,136,68,177,251,11,182,236,125,122,4,253,146,16,98,178,252,129,61,80,183,48,195,86,133,155,63,216,204,189,191,22,47,187,45,229,58,184,219,113,157,134,235,232,105,148,149,20,242,19,29,66,174,70,28,7,25,67,141,250,226,218,73,194,33,175,79,239,224,100,193,228,166,215,95,35,246,75,245,77,13,238,50,209,118,176,71,131,62,2,223,240,181,203,147,119,151,101,132,126,5,121,99,14,26,128,117,244,110,222,42,89,85,24,237,225,139,143,142,74,10,17,57,231,72,150,162,199,36,54,234,96,230,40,12,55,51,158,46,196,221,172,198,205,32,88,116,15,254,217,30,84,167,97,39,108,171,137,120,27,202]},"player":3,"iterations":10000}

//let savedState = {"game":{"hands":[["6♦","6♠","2♣","1♣","A♥","4♣","7♠","A♦","6♥","9♦","4♥","2♠","7♦"],[null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null]],"trick":[null,null,null,null],"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"receivedHearts":[false,false,false,false],"score":[0,0,0,0],"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":14,"S":[194,207,102,146,41,118,121,21,210,7,155,112,70,174,135,152,27,220,123,73,159,200,252,246,11,253,91,51,144,2,229,213,67,122,108,94,8,145,82,180,156,115,77,34,64,184,202,46,53,150,162,74,80,170,40,234,149,127,216,99,192,63,65,204,175,84,250,45,139,157,56,201,239,209,182,188,25,190,55,251,186,172,44,198,32,3,109,19,219,58,187,208,143,248,245,171,4,36,133,230,243,10,17,113,153,126,231,9,78,83,138,197,76,61,247,218,222,95,233,244,129,167,116,132,97,160,151,249,71,130,125,235,111,86,38,131,66,23,15,5,225,212,33,103,105,85,254,242,173,147,26,110,35,87,39,22,42,90,20,232,240,18,119,69,1,72,13,100,203,52,137,31,98,211,120,217,107,223,183,177,104,195,88,158,214,237,221,164,16,179,79,238,47,124,163,48,141,255,106,68,96,206,205,148,199,193,226,178,6,196,136,101,28,50,176,93,30,161,29,92,62,224,154,215,0,227,24,43,89,168,142,75,81,60,128,166,185,169,114,59,57,241,140,37,49,134,236,14,12,117,165,228,189,54,191,181]},"player":0,"iterations":10000};

// bisca, why not give points and play low card to preserve the turn?
// let savedState = {"game":{"numberOfPlayers":2,"currentPlayer":1,"deck":[],"hands":[["A♦","7♥","7♦","K♦","K♠","K♥","Q♠","4♥","4♦"],[null,null,null,null,null,null,null,null]],"trick":[null,"5♦"],"trumpCard":"4♦","trump":"♦","wonCards":[["A♠","6♠","6♦","3♣","5♠","3♠","7♣","2♣","2♠","6♥","3♦","5♥"],["4♣","A♣","6♣","K♣","4♠","7♠","2♥","J♥","3♥","5♣"]],"round":12,"suitToFollow":"♦","hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":247,"j":90,"S":[121,172,60,81,214,94,2,178,247,181,39,254,166,227,23,82,234,212,218,57,101,148,153,42,77,128,59,160,180,145,89,7,126,96,236,196,15,142,208,243,56,54,3,25,85,32,219,156,220,158,162,103,223,252,141,161,150,171,72,244,198,151,203,235,5,149,11,200,226,170,84,187,45,30,70,132,229,105,28,168,157,125,69,228,67,209,147,102,146,116,241,74,50,40,27,130,127,211,138,199,4,221,111,251,108,250,13,255,91,88,65,66,225,38,52,201,174,61,47,6,95,49,136,37,99,71,140,36,62,26,109,0,143,120,205,215,97,159,68,253,100,249,34,55,41,246,16,177,44,194,217,90,117,179,31,239,175,51,20,29,83,216,33,46,87,98,107,118,119,232,192,183,190,24,152,8,80,9,176,124,92,206,93,73,1,224,184,207,112,213,189,18,79,76,167,22,144,122,48,113,137,53,155,210,64,154,78,43,240,248,202,204,86,169,123,139,134,115,106,173,242,58,165,237,230,191,131,12,188,104,163,35,21,114,182,238,75,129,17,222,14,193,10,195,110,186,63,245,197,133,135,233,164,19,231,185]},"player":1,"iterations":10000}

// hearts, situation where pure random is extremely slow
// let savedState = {"game":{"nextPlayer":2, "winners": null, "isHeartsBroken": true, "hands":[[null,null,null,null,null,null,null,null,null,null],["J♥","1♦","8♠","Q♥","5♥","1♣","A♠","2♥","8♦","8♣"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],"trick":[null,null,null,null],"wonCards":[["K♣","J♣","4♣","2♣","Q♠","9♠","7♠","6♠"],["J♠","K♠","A♥","A♣"],[],[]],"round":4,"suitToFollow":null,"receivedHearts":[false,true,false,false],"score":[13,1,0,0],"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":false,"♥":true,"♦":true,"♣":true},{"♠":false,"♥":true,"♦":true,"♣":true}]},"rng":{"i":76,"j":64,"S":[223,29,69,195,28,193,204,124,30,15,94,197,89,152,76,25,47,75,7,112,143,250,151,126,52,101,90,251,180,67,161,209,9,234,139,81,217,23,91,20,3,157,79,216,106,138,77,188,135,17,63,118,210,220,86,35,202,40,62,61,31,85,54,10,198,100,186,145,221,128,225,235,59,18,11,55,103,189,111,243,68,153,183,12,182,169,8,165,105,42,208,87,214,48,249,39,58,21,132,154,166,0,196,192,201,1,104,148,133,6,247,73,255,211,162,4,109,13,252,107,5,187,240,232,185,184,36,2,181,178,129,164,205,43,102,242,49,83,207,119,222,237,171,71,177,228,245,229,123,168,51,158,114,176,167,96,117,142,74,27,32,41,78,37,173,239,65,233,236,190,170,219,92,174,72,88,33,134,130,179,24,97,60,160,231,248,116,238,150,137,80,56,203,246,163,99,155,93,244,254,147,199,53,172,200,224,127,34,57,19,230,156,212,14,206,115,45,84,131,159,50,218,125,241,140,136,98,194,64,121,16,149,95,46,70,253,110,226,44,108,213,38,66,141,215,175,144,120,113,191,22,146,227,82,26,122]},"player":2,"iterations":10000}
// let savedState = {"game":{"nextPlayer":2, "winners": null, "isHeartsBroken": true, "hands":[[null,null,null,null,null,null,null,null,null,null],["J♥","1♦","8♠","Q♥","5♥","1♣","A♠","2♥","8♦","8♣"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]],"trick":[null,null,null,null],"wonCards":[["K♣","J♣","4♣","2♣","Q♠","9♠","7♠","6♠"],["J♠","K♠","A♥","A♣"],[],[]],"round":4,"suitToFollow":null,"receivedHearts":[false,true,false,false],"score":[13,1,0,0],"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":76,"j":64,"S":[223,29,69,195,28,193,204,124,30,15,94,197,89,152,76,25,47,75,7,112,143,250,151,126,52,101,90,251,180,67,161,209,9,234,139,81,217,23,91,20,3,157,79,216,106,138,77,188,135,17,63,118,210,220,86,35,202,40,62,61,31,85,54,10,198,100,186,145,221,128,225,235,59,18,11,55,103,189,111,243,68,153,183,12,182,169,8,165,105,42,208,87,214,48,249,39,58,21,132,154,166,0,196,192,201,1,104,148,133,6,247,73,255,211,162,4,109,13,252,107,5,187,240,232,185,184,36,2,181,178,129,164,205,43,102,242,49,83,207,119,222,237,171,71,177,228,245,229,123,168,51,158,114,176,167,96,117,142,74,27,32,41,78,37,173,239,65,233,236,190,170,219,92,174,72,88,33,134,130,179,24,97,60,160,231,248,116,238,150,137,80,56,203,246,163,99,155,93,244,254,147,199,53,172,200,224,127,34,57,19,230,156,212,14,206,115,45,84,131,159,50,218,125,241,140,136,98,194,64,121,16,149,95,46,70,253,110,226,44,108,213,38,66,141,215,175,144,120,113,191,22,146,227,82,26,122]},"player":2,"iterations":10000}

// hearts, to test hearts player shot the moon
// let savedState = {"game":{"hands":[[],["3♥"],[],[]],"nextPlayer":2,"lastTrick":null,"trick":["2♥",null,"K♥","6♥"],"wonCards":[["A♠","7♠","5♠","8♠","A♦","1♦","J♦","2♦"],["6♣","K♣","J♣","2♣"],["4♦","8♦","Q♦","Q♠","K♦","9♠","J♠","3♠","9♦","4♠","6♠","2♠","7♦","6♦","K♠","1♣","3♣","A♥","9♣","7♣","3♦","Q♥","1♠","J♥","1♥","7♥","A♣","9♥","8♥","4♥","5♦","5♥"],["4♣","5♣","8♣","Q♣"]],"round":13,"suitToFollow":"♥","receivedHearts":[false,false,true,false],"isHeartsBroken":false,"hasSuits":[{"♠":false,"♥":true,"♦":false,"♣":false},{"♠":false,"♥":true,"♦":false,"♣":false},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":false,"♥":true,"♦":false,"♣":false}],"score":[0,0,22,0],"winners":null,"error":false},"rng":{"i":77,"j":80,"S":[158,99,230,194,88,32,35,195,190,111,161,171,199,22,94,122,63,106,78,229,125,24,217,83,203,60,247,189,27,116,103,208,34,1,198,46,59,48,95,215,218,150,227,156,129,182,178,77,45,155,101,87,255,40,173,205,93,69,148,206,216,113,115,6,132,70,13,66,212,197,134,91,142,81,146,220,169,180,246,8,23,175,117,97,114,219,84,186,237,0,231,164,244,192,124,165,10,210,30,170,245,138,207,118,18,68,92,54,14,128,157,123,43,213,12,222,73,191,143,241,42,153,15,202,56,109,44,172,31,20,232,38,3,86,100,25,62,177,52,228,55,107,29,21,226,188,176,131,149,135,17,183,65,254,187,147,108,127,75,82,239,167,200,19,214,240,64,179,140,139,250,253,37,51,7,141,49,9,168,225,104,160,5,57,90,193,152,47,151,174,137,72,233,126,223,133,98,50,201,11,26,154,16,184,166,185,89,159,120,28,234,251,76,96,249,53,162,224,58,4,221,2,238,209,145,61,121,85,204,243,105,242,112,33,74,80,39,235,130,41,144,211,71,163,252,236,67,79,248,102,196,36,110,181,136,119]},"player":2,"iterations":10000};

// random testing
// let savedState = {"date":"Mon May 02 2016 22:50:05 GMT+0100 (WEST)","game":{"hands":[[null,null,null],[null,null,null],["4♠","3♠","J♦","2♠"],[null,null,null]],"hasSuits":[{"♠":true,"♣":true,"♥":true,"♦":true},{"♠":false,"♣":true,"♥":false,"♦":true},{"♠":true,"♣":false,"♥":true,"♦":true},{"♠":true,"♣":false,"♥":true,"♦":false}],"lastTrick":null,"nextPlayer":3,"round":7,"score":[18,81],"suitToFollow":"♥","trick":["A♥","5♣",null,"4♥"],"trumpCard":"7♥","trumpPlayer":4,"trumpSuit":"♥","winners":null,"wonCards":[["A♠","5♠","J♠","K♠"],["3♦","A♦","4♦","7♣","3♣","A♣","Q♣","J♣","Q♠","K♥","6♠","7♠"],[],["2♣","K♣","6♥","7♥","K♦","2♦","7♦","5♥"]]},"gameId":"842973a907f60209","gameType":"sueca","id":"842973a907f60209_29","iterations":10000,"player":3,"rng":{"S":[4,124,23,90,183,163,156,108,220,248,45,119,99,16,236,232,171,233,41,166,10,196,117,230,42,231,75,151,127,145,63,76,142,91,242,83,71,247,214,101,241,188,219,251,107,82,133,187,254,98,11,135,211,37,116,36,237,130,218,229,252,27,185,31,80,192,68,96,255,60,38,73,95,88,47,246,205,122,144,81,186,207,65,103,129,85,240,234,224,177,50,14,113,243,72,215,138,238,30,160,87,213,147,7,239,150,164,209,204,67,97,132,225,18,131,77,20,61,0,105,228,94,235,149,176,15,114,197,46,174,202,70,123,154,78,9,146,52,19,170,109,203,1,6,74,194,58,201,226,250,182,184,100,48,206,51,22,93,193,106,43,110,89,40,34,169,216,25,69,136,57,168,12,139,17,86,56,84,227,134,153,39,167,121,102,208,175,62,217,49,180,32,2,53,141,152,128,35,79,172,165,249,59,3,115,33,244,223,118,212,44,190,120,54,8,173,29,126,64,66,178,5,245,92,253,13,21,200,189,143,195,181,26,162,55,157,191,159,221,28,140,199,155,198,148,111,24,137,104,125,161,112,210,158,179,222],"i":0,"j":229},"stateNumber":29,"timestamp":1462225805848,"type":"gameState"};
// let savedState = {"date":"Tue May 03 2016 00:32:39 GMT+0100 (WEST)","game":{"hands":[[null,null,null,null],[null,null,null,null],["4♣","A♦","3♣","5♣","6♦"],[null,null,null,null]],"hasSuits":[{"♠":false,"♣":true,"♥":true,"♦":true},{"♠":false,"♣":true,"♥":true,"♦":true},{"♠":true,"♣":true,"♥":false,"♦":true},{"♠":true,"♣":false,"♥":true,"♦":true}],"lastTrick":null,"nextPlayer":3,"round":6,"score":[12,61],"suitToFollow":"♠","trick":["6♥","Q♦",null,"K♠"],"trumpCard":"6♦","trumpPlayer":3,"trumpSuit":"♦","winners":null,"wonCards":[[],[],["Q♥","4♥","5♦","7♥"],["2♠","4♠","5♠","A♠","5♥","3♥","2♥","A♥","3♠","7♣","Q♠","7♠","2♣","J♣","A♣","J♦"]]},"gameId":"63cf447a719237c3","gameType":"sueca","id":"63cf447a719237c3_25","iterations":10000,"player":3,"rng":{"S":[167,237,141,193,38,191,33,61,125,46,117,229,164,98,246,208,187,22,254,251,75,136,250,135,31,99,146,235,239,101,13,162,182,90,121,9,64,198,80,95,23,5,24,59,21,48,36,218,104,168,1,71,58,170,29,63,184,166,201,211,133,60,185,230,204,94,150,108,144,39,137,66,210,209,45,181,85,40,52,14,130,223,160,222,161,143,203,212,175,118,231,70,120,159,228,202,100,41,26,134,255,188,217,157,53,215,3,49,76,84,153,171,140,205,128,97,32,7,216,69,51,81,106,109,245,200,27,56,152,77,67,197,242,189,122,88,25,107,112,19,195,18,16,6,232,79,123,0,169,249,180,173,219,102,199,221,139,30,50,163,116,127,148,2,241,158,113,156,43,207,129,37,213,12,124,220,78,247,236,226,194,20,142,96,192,15,151,47,86,179,17,28,87,248,238,93,115,154,196,8,186,82,155,138,54,74,114,253,35,89,62,165,4,214,34,183,149,174,234,177,73,178,243,105,147,240,227,83,111,172,55,252,110,92,244,42,44,233,103,131,57,206,10,65,68,11,132,224,190,119,145,72,126,225,176,91],"i":0,"j":151},"stateNumber":25,"timestamp":1462231959642,"type":"gameState"};
// let savedState = {"date":"Tue May 03 2016 21:36:41 GMT+0100 (WEST)","game":{"hands":[[null,null],[null],[null],["A♠","4♠"]],"hasSuits":[{"♠":true,"♣":true,"♥":false,"♦":false},{"♠":true,"♣":false,"♥":true,"♦":true},{"♠":true,"♣":false,"♥":true,"♦":true},{"♠":true,"♣":false,"♥":true,"♦":false}],"lastTrick":null,"nextPlayer":4,"round":9,"score":[55,40],"suitToFollow":"♠","trick":[null,"J♠","2♠",null],"trumpCard":"2♠","trumpPlayer":3,"trumpSuit":"♠","winners":null,"wonCards":[["7♠","Q♥","5♥","7♥","A♦","6♦","J♦","7♦","5♠","K♦","3♦","2♣"],["3♣","A♣","4♣","7♣","6♣","Q♠","4♦","6♥"],["J♣","Q♣","3♠","5♣"],["4♥","K♥","3♥","A♥","2♦","Q♦","5♦","6♠"]]},"gameId":"e5957945387cad04","gameType":"sueca","id":"e5957945387cad04_36","iterations":10000,"player":4,"rng":{"S":[122,185,154,132,81,34,93,239,228,143,66,211,243,215,87,19,201,45,14,74,55,149,8,248,235,150,186,252,72,18,209,250,104,159,153,20,199,204,188,117,60,112,41,139,138,70,83,119,241,29,48,255,191,219,59,6,157,85,103,135,11,194,152,36,206,247,38,28,111,0,172,62,170,217,165,187,238,22,214,184,24,169,123,141,168,61,96,71,178,127,94,56,115,230,100,253,10,244,233,77,240,195,176,205,50,163,49,80,33,225,91,97,110,229,63,76,197,193,105,156,151,171,181,242,116,65,160,89,43,16,30,95,21,27,106,109,175,121,183,126,190,140,12,196,226,166,174,251,23,58,210,114,254,35,52,148,118,113,84,7,40,99,220,192,9,213,67,3,180,236,92,13,82,208,69,128,203,26,161,147,86,158,167,107,37,223,218,25,39,57,46,129,198,124,68,216,1,90,42,73,101,162,130,4,125,44,131,164,142,202,32,31,249,54,88,133,234,207,155,245,137,64,102,144,136,224,145,200,177,232,47,2,17,78,5,120,231,212,179,173,182,237,51,227,189,146,134,98,222,75,246,221,15,79,108,53],"i":0,"j":210},"stateNumber":36,"timestamp":1462307801524,"type":"gameState"};
// let savedState = {"date":"Tue May 03 2016 21:55:30 GMT+0100 (WEST)","game":{"hands":[[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null],["A♠","K♣","A♥","6♠","3♥","Q♠"]],"hasSuits":[{"♠":true,"♣":false,"♥":true,"♦":true},{"♠":true,"♣":true,"♥":true,"♦":false},{"♠":false,"♣":true,"♥":true,"♦":true},{"♠":true,"♣":true,"♥":true,"♦":true}],"lastTrick":null,"nextPlayer":4,"round":5,"score":[27,12],"suitToFollow":"♣","trick":[null,null,"A♣",null],"trumpCard":"4♣","trumpPlayer":4,"trumpSuit":"♣","winners":null,"wonCards":[["A♦","2♦","J♦","4♦"],["7♦","Q♣","6♦","3♦","2♠","6♣","2♣","4♣"],["7♠","4♠","J♣","5♠"],[]]},"gameId":"ad96fd52af48e14f","gameType":"sueca","id":"ad96fd52af48e14f_19","iterations":10000,"player":4,"rng":{"S":[87,86,231,187,215,88,25,175,2,222,114,195,198,165,97,65,157,11,220,51,197,149,235,83,45,151,202,152,43,123,243,72,219,173,224,211,78,183,212,117,249,248,125,223,155,64,141,1,253,140,63,98,120,10,0,239,132,103,32,182,170,119,199,176,161,142,70,168,241,209,105,129,181,56,38,172,113,246,160,22,131,124,57,244,115,190,3,21,229,208,196,163,96,73,102,33,108,143,134,100,46,106,174,233,52,126,101,91,225,67,36,104,247,227,75,255,6,217,62,17,193,5,118,61,216,207,85,66,185,238,203,84,28,214,79,30,144,76,81,200,204,112,35,210,39,158,77,55,228,145,250,213,26,194,146,188,156,236,9,44,221,135,218,19,147,27,180,137,192,48,201,24,15,53,90,110,12,116,4,42,186,60,80,89,31,133,164,237,230,121,107,92,232,37,191,138,49,177,251,34,14,18,50,94,254,69,154,13,59,71,95,7,122,93,150,54,130,20,136,41,82,47,29,8,153,74,68,148,206,169,205,139,226,189,234,252,159,245,242,179,162,40,16,128,109,111,99,184,23,171,167,58,166,127,178,240],"i":0,"j":149},"stateNumber":19,"timestamp":1462308930687,"type":"gameState"};
let savedState = {"date":"Wed May 04 2016 00:00:57 GMT+0100 (WEST)","game":{"hands":[[],[],[],[]],"hasSuits":[{"♠":true,"♣":false,"♥":false,"♦":false},{"♠":false,"♣":true,"♥":true,"♦":false},{"♠":false,"♣":false,"♥":false,"♦":true},{"♠":false,"♣":false,"♥":true,"♦":true}],"lastTrick":null,"nextPlayer":4,"round":11,"score":[60,60],"suitToFollow":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":1,"trumpSuit":"♣","winners":null,"wonCards":[["A♥","3♥","Q♥","K♥","A♠","5♠","Q♠","4♠","A♣","5♣","K♣","4♣"],["2♥","Q♣","3♦","3♣","6♥","7♣","4♥","4♦"],["6♠","Q♦","7♠","J♠"],["2♦","K♦","6♦","A♦","K♠","2♣","6♣","J♣","3♠","5♥","J♦","7♥","2♠","J♥","5♦","7♦"]]},"gameId":"f440a5a84411d47f","gameType":"sueca","id":"f440a5a84411d47f_42","iterations":10000,"player":4,"rng":{"S":[155,92,246,123,103,101,132,46,82,161,175,50,237,59,200,33,194,245,227,28,124,100,219,177,55,251,235,186,209,249,144,182,31,115,76,168,178,8,16,137,29,232,163,79,109,173,152,247,135,11,171,116,5,38,75,105,20,244,255,43,4,207,196,129,30,241,113,159,183,18,222,10,223,189,203,204,125,121,6,239,37,167,130,131,221,93,73,211,84,61,169,62,141,63,145,47,117,25,197,114,147,170,157,53,252,72,7,195,180,42,90,119,98,231,229,106,70,96,166,228,143,192,0,9,68,40,36,69,122,3,83,156,56,151,34,154,253,51,45,185,216,60,217,89,118,250,248,236,14,225,104,87,172,19,142,187,74,97,80,126,102,26,201,230,191,150,71,206,52,110,112,254,58,208,67,17,13,176,99,27,64,35,65,108,95,164,134,242,21,88,184,1,214,94,243,49,190,205,234,127,174,86,188,133,32,66,48,77,22,153,220,199,148,128,238,78,140,226,139,81,41,44,12,138,107,111,120,136,149,160,146,179,54,15,233,23,158,213,240,85,210,198,91,193,24,224,162,181,165,218,2,202,57,215,39,212],"i":0,"j":180},"stateNumber":42,"timestamp":1462316457653,"type":"gameState"};

rng = seedrandom(null, { state: savedState.rng });

let game = new Game(savedState.game);

let util = require('util');
//console.log(util.inspect(a, {showHidden: false, depth: null}));
/*
let count = {};

for(let i = 0; i < 200000; i++) {

  if (i % 1000 === 0) {
    console.log(i);
  }

  let cloneGame = new Game(game);
  cloneGame = cloneGame.randomize(rng, savedState.player);
  if (_.some(cloneGame.hands, hand => _.some(hand, card => card === undefined))) {
    throw new Error('fodeu');
  }

  let string = cloneGame.hands.toString();

  if (!count[string]) {
    count[string] = 1;
  } else {
    count[string] += 1;
  }
}

console.log(count);
console.log(Object.keys(count).length);
*/

let searchAlgorithm = new ISMCTS(game, savedState.player, {rng: rng, iterations: 10000});

// let minimax = new Minimax(game, savedState.player, 13);

//let minimaxMove = minimax.selectMove();

//let searchAlgorithm = new DeterminizedUCT(game, savedState.player, { rng: rng });


console.time('selectMove');
let move = searchAlgorithm.selectMove();
console.timeEnd('selectMove');

console.log(game.getPrettyPlayerHand(game.nextPlayer));
console.log(game.nextPlayer + ' played ' + move  + '\n');
// console.log(game.currentPlayer + ' minimax played ' + minimaxMove  + '\n');
// game.performMove(move);
console.time('save');
Dumper.saveGameStateAndTreeToFiles('test.json', searchAlgorithm);
console.timeEnd('save');
