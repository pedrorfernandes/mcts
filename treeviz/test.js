var ISMCTS = require('../search/ismcts.js').ISMCTS;
var stringify = require('json-stringify-safe');
var Dumper = require('./dumper.js');
var Minimax = require('../search/minimax.js').Minimax;

var seedrandom = require('seedrandom');
var rng = seedrandom();

var Sueca = require('../games/sueca').Sueca;
var MiniSueca = require('../games/mini-sueca').MiniSueca;
var Bisca = require('../games/bisca').Bisca;

var Game = Bisca;

var seed = 0.17233211455043446 //rng();
console.log(seed);

// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["A♠","Q♣","5♥","2♣","Q♠","4♦","K♦","7♠","7♥"]],"trump":"♦","trick":["6♥","A♥","3♥",null],"trumpCard":"3♦","trumpPlayer":1,"wonCards":[["2♦","4♣","J♣","A♣"],[],[],[]],"round":2,"suitToFollow":"♥","hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":false},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":108,"S":[134,4,140,191,100,118,9,59,153,251,196,157,215,47,68,91,235,15,111,13,32,107,20,213,241,115,81,123,201,137,204,23,53,37,75,181,207,131,26,39,30,65,203,189,234,28,182,237,214,178,146,164,55,247,2,255,109,88,230,124,43,94,7,116,228,0,192,119,5,102,125,101,145,113,70,139,162,71,114,209,129,141,184,195,54,12,117,151,31,11,248,193,150,172,226,77,14,186,154,50,211,242,216,231,67,74,41,175,133,69,6,78,21,168,199,61,93,187,18,45,246,169,249,232,250,103,225,105,22,35,73,92,90,142,95,128,148,58,220,190,233,40,160,27,171,223,80,132,218,224,44,188,83,10,254,138,238,136,185,56,208,108,62,97,1,122,197,3,84,217,205,144,159,194,130,176,19,222,180,212,104,121,147,155,158,240,24,120,46,202,89,52,198,8,126,85,34,112,243,72,167,227,174,106,76,51,38,79,36,156,244,143,221,96,161,60,17,152,206,245,48,42,135,49,163,200,239,82,16,179,33,229,29,170,210,149,98,99,87,110,57,64,253,127,63,236,219,173,165,177,25,86,166,66,252,183]},"player":3,"iterations":10000};

// var savedState = {"game":{"currentPlayer":1,"hands":[[],["4♥","4♦","K♦","J♣","2♠","5♣","J♥","2♦","7♦","K♣"],[],[]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"3♣","trumpPlayer":0,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":20,"S":[67,54,108,170,63,64,203,207,221,155,184,92,204,182,40,158,219,113,49,183,50,102,225,147,248,149,209,193,72,241,253,157,196,75,60,100,245,38,202,87,230,212,103,224,24,237,195,236,107,137,220,243,227,25,188,165,252,172,12,134,153,47,0,143,139,168,181,223,231,21,33,161,176,197,106,36,205,18,199,254,53,95,5,206,185,235,123,142,41,88,22,58,133,85,109,151,146,80,216,234,251,239,23,77,48,213,115,166,1,148,229,214,79,104,15,173,66,159,160,174,189,169,180,10,164,240,129,178,93,247,42,126,11,26,250,71,116,43,124,122,162,90,140,91,179,175,32,117,89,226,194,3,135,20,14,136,154,101,171,121,61,190,217,150,128,167,145,114,112,131,74,211,97,29,105,62,111,98,132,210,76,27,120,46,52,191,242,94,73,186,4,238,152,68,125,246,198,86,30,119,233,59,130,56,96,13,192,44,37,6,249,28,17,83,16,118,7,208,9,141,215,69,78,138,51,228,39,200,255,156,70,201,31,127,55,244,163,2,57,144,218,45,19,110,222,84,34,187,99,8,177,81,65,82,35,232]},"player":1,"iterations":10000}

// A or 7 in hand, what to use first
// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["J♥","A♠","J♠","6♥","7♠","Q♠","7♥","5♦","4♦","Q♥"]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"7♣","trumpPlayer":2,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":173,"S":[180,111,205,246,14,179,252,136,185,12,40,17,133,114,43,62,235,67,0,130,184,196,157,197,217,41,169,115,50,58,142,147,25,165,168,122,42,89,51,93,224,27,26,152,201,216,189,37,36,174,105,228,193,48,57,144,207,172,59,153,127,79,75,214,186,242,94,86,243,159,148,77,63,68,81,250,3,10,103,34,206,233,128,199,253,237,30,166,74,90,182,248,240,254,29,236,171,102,155,4,160,162,84,150,215,255,188,178,2,7,66,18,137,53,110,116,80,139,167,121,78,113,219,146,251,23,232,195,163,100,226,154,88,239,61,13,65,108,125,19,60,173,5,98,204,134,46,31,170,183,22,131,45,247,211,231,28,176,70,202,32,156,52,181,161,129,203,9,151,109,132,145,119,64,194,20,245,241,143,200,21,192,95,164,120,85,238,55,177,158,138,101,213,135,69,244,190,72,49,44,218,141,112,149,16,6,230,106,187,83,24,82,76,1,54,96,71,117,126,33,104,223,208,225,229,38,198,92,91,234,220,140,123,73,11,47,97,221,99,124,222,15,39,227,249,209,56,35,8,175,210,191,87,118,212,107]},"player":3,"iterations":10000};

// var savedState = {"game":{"currentPlayer":1,"hands":[[],["6♠","6♣","3♥","6♦","J♣","J♦","2♦","A♥"],[],[]],"trump":"♣","trick":["4♥",null,null,null],"trumpCard":"7♣","trumpPlayer":2,"wonCards":[["2♣","3♠","2♠","A♠"],[],[],["5♠","K♠","4♠","7♠"]],"round":3,"suitToFollow":"♥","hasSuits":[{"♠":false,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":63,"S":[167,66,76,155,14,147,226,99,144,199,196,72,224,100,218,168,142,180,63,109,85,221,246,138,52,107,94,106,22,77,119,236,162,160,59,214,124,241,208,164,40,39,154,240,112,24,6,132,11,235,253,35,250,15,105,115,178,165,186,56,148,133,81,143,32,34,20,182,198,255,141,135,249,2,242,254,211,151,88,171,174,70,64,201,37,244,110,61,67,58,179,62,111,137,86,139,75,188,202,50,200,234,51,189,176,93,12,127,161,26,183,220,18,219,252,225,203,16,3,0,152,78,69,233,73,21,136,213,101,90,80,157,84,43,131,54,79,36,82,140,210,230,191,47,25,156,31,192,195,30,4,206,29,245,96,193,44,104,38,45,23,89,27,187,123,92,103,209,146,60,121,114,71,74,48,205,130,227,223,134,169,87,42,145,190,216,10,194,153,175,91,177,158,243,57,231,41,204,215,128,150,166,125,83,49,116,228,95,98,17,65,118,53,251,248,19,113,129,9,222,68,232,184,181,163,97,28,13,126,108,229,117,102,217,212,5,8,7,239,237,197,238,33,207,172,149,120,173,159,247,170,46,185,55,1,122]},"player":1,"iterations":10000};

// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♥","J♥","7♥","3♥","A♣","J♠","6♦","5♠","6♠"]],"trump":"♣","trick":[null,null,null,null],"trumpCard":"2♣","trumpPlayer":2,"wonCards":[[],[],[],["2♦","Q♦","4♦","A♦"]],"round":2,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":121,"S":[5,111,224,182,249,129,89,38,29,153,116,113,117,32,43,98,192,77,138,125,64,196,21,33,130,165,10,181,49,8,220,132,50,107,65,227,228,102,247,175,22,56,134,226,169,156,96,176,92,214,34,191,67,222,207,198,47,250,221,205,162,122,12,78,242,211,59,193,135,236,63,103,210,184,81,174,186,172,7,71,234,173,119,188,146,199,251,126,203,167,202,123,62,15,204,53,254,212,237,35,225,42,219,255,208,155,157,72,151,190,163,120,99,252,45,144,39,73,20,106,30,58,2,60,195,159,115,230,27,170,164,17,244,46,158,253,147,216,246,51,243,28,128,76,194,68,218,248,37,84,87,215,118,131,109,133,93,79,104,105,206,209,180,83,177,139,200,166,127,187,94,6,239,160,201,86,231,52,223,88,97,85,57,152,31,161,61,154,112,148,189,149,3,217,44,179,213,1,145,141,168,9,19,110,238,25,11,232,80,41,90,24,26,66,136,36,95,229,185,55,70,69,121,82,74,48,178,40,13,18,143,14,240,183,150,140,114,108,233,16,0,75,23,4,137,54,171,235,91,142,124,101,241,100,197,245]},"player":3,"iterations":10000}

// 4 card game
// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","Q♥","J♦","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","6♠","5♠","4♠","3♠"],["A♥","7♥","6♥","5♥","4♥","3♥"],["A♦","7♦","6♦","5♦","4♦","3♦"],["A♣","7♣","6♣","5♣","4♣","3♣"]],"round":7,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};


// 3 card game
// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","Q♥","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","J♠","6♠","5♠","4♠","3♠"],["A♥","7♥","J♥","6♥","5♥","4♥","3♥"],["A♦","7♦","J♦","6♦","5♦","4♦","3♦"],["A♣","7♣","J♣","6♣","5♣","4♣","3♣"]],"round":8,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};

// 2 card game
// var savedState = {"game":{"currentPlayer":3,"hands":[[],[],[],["K♦","2♠"]],"trump":null,"trick":[null,null,null,null],"trumpCard":"A♣","trumpPlayer":2,"wonCards":[["A♠","7♠","Q♠","J♠","6♠","5♠","4♠","3♠"],["A♥","7♥","Q♥","J♥","6♥","5♥","4♥","3♥"],["A♦","7♦","Q♦","J♦","6♦","5♦","4♦","3♦"],["A♣","7♣","Q♣","J♣","6♣","5♣","4♣","3♣"]],"round":9,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"player":3};

// var savedState = {"game":{"currentPlayer":0,"hands":[["2♠","2♦","Q♥"],[],[],[]],"trump":"♠","trick":[null,null,null,null],"trumpCard":"K♠","trumpPlayer":3,"wonCards":[[],[],[],[]],"round":1,"suitToFollow":null,"hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":null,"player":0};

// bisca, should play the easy A♥
// var savedState = {"game":{"numberOfPlayers":2,"currentPlayer":1,"deck":[null,"A♣"],"hands":[["A♥","J♣","4♣","6♠","2♦","Q♠","5♥","2♣","4♠"],[null,null,null,null,null,null,null,null]],"trick":[null,"K♥"],"trumpCard":"A♣","trump":"♣","wonCards":[["5♠","2♠","A♠","J♠","7♣","Q♥","2♥","Q♦","4♥","J♦"],["6♥","7♥","3♦","4♦","3♠","5♦","3♥","6♦","K♠","7♠"]],"round":11,"suitToFollow":"♥","hasSuits":[{"♠":true,"♥":true,"♦":true,"♣":true},{"♠":true,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":120,"S":[166,95,4,92,192,218,206,65,107,10,26,178,212,49,24,30,31,83,59,119,167,153,227,128,93,160,170,181,142,243,193,136,174,228,121,56,158,69,41,117,77,103,123,5,118,239,157,134,223,100,179,112,57,152,50,252,210,229,143,131,61,11,221,122,80,144,132,71,73,189,207,22,66,253,194,114,164,135,195,35,138,45,13,86,68,42,211,0,21,238,249,156,85,197,127,1,89,111,94,18,115,159,34,188,25,33,27,208,219,169,186,205,200,133,101,196,125,78,154,183,191,215,222,146,14,247,251,102,234,161,40,7,39,173,54,16,203,74,245,48,15,163,53,255,2,109,84,47,155,60,148,130,63,240,98,76,236,108,38,99,19,20,225,75,52,46,199,90,140,217,88,113,72,190,204,176,106,232,233,67,139,168,55,8,87,147,70,91,184,105,244,17,137,81,23,224,43,150,216,110,64,36,177,171,248,202,129,172,180,231,29,214,165,198,182,241,213,226,104,32,235,162,9,124,44,145,58,6,237,209,62,120,3,97,149,254,126,201,96,187,51,242,116,175,246,12,151,79,82,220,250,28,37,141,230,185]},"player":1,"iterations":10000};
  
var savedState = {"game":{"numberOfPlayers":2,"currentPlayer":2,"deck":[],"hands":[[null,null,"K♣"],["2♥","4♥","2♣","6♦"]],"trick":["3♠",null],"trumpCard":"K♣","trump":"♣","wonCards":[["Q♣","Q♥","J♠","2♠","5♣","5♥","3♣","4♦","6♣","6♠","A♣","3♦","7♣","5♦","4♣","4♠","J♦","Q♦","K♥","6♥","7♠","5♠","A♦","K♦","Q♠","A♥"],["2♦","7♦","A♠","J♣","3♥","7♥"]],"round":17,"suitToFollow":"♠","hasSuits":[{"♠":false,"♥":true,"♦":true,"♣":true},{"♠":false,"♥":true,"♦":true,"♣":true}]},"rng":{"i":0,"j":62,"S":[24,198,67,243,62,77,214,244,204,237,104,26,213,124,15,129,31,241,63,23,182,19,255,112,117,68,206,159,66,83,122,252,200,195,61,58,86,183,234,253,203,41,216,5,132,227,46,11,134,45,192,76,242,240,125,140,0,189,145,17,87,108,146,70,32,161,75,69,162,225,235,82,155,131,174,191,212,248,230,165,9,229,35,236,144,3,254,116,188,128,172,194,27,171,14,228,137,54,12,2,28,107,130,197,43,30,101,55,186,42,20,164,73,136,25,97,7,89,4,121,8,105,103,93,133,72,187,150,65,153,178,219,211,151,78,71,160,220,18,166,114,168,249,51,221,218,126,53,37,176,251,226,85,100,215,180,148,217,245,91,205,102,163,135,115,36,47,57,111,49,90,106,44,181,246,149,110,199,173,74,208,247,156,60,201,232,196,50,123,33,231,127,34,143,109,38,233,92,84,157,184,154,175,79,88,167,6,224,119,94,120,48,158,222,190,59,118,98,169,152,10,80,52,250,177,64,142,141,170,40,147,138,1,96,95,185,179,16,81,223,209,113,99,207,21,202,139,39,22,56,193,239,210,13,238,29]},"player":2,"iterations":10000};

var game = new Game(savedState.game);

var util = require('util');
//console.log(util.inspect(a, {showHidden: false, depth: null}));

var mcts = new ISMCTS(game, 10000, savedState.player, seed);
//var minimax = new Minimax(game, savedState.player, 13);

//var minimaxMove = minimax.selectMove();


console.time('selectMove');
var move = mcts.selectMove();
console.timeEnd('selectMove');

console.log(game.getPrettyPlayerHand(game.currentPlayer));
console.log(game.currentPlayer + ' played ' + move  + '\n');
// console.log(game.currentPlayer + ' minimax played ' + minimaxMove  + '\n');
game.performMove(move);
Dumper.saveAll('test.json', mcts);
